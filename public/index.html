<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Individual Performance Report</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Unified Gray Scrollbar Styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        /* Firefox */
        * {
            scrollbar-width: thin;
            scrollbar-color: #94a3b8 #f1f5f9;
        }
        
        .tab-active {
            border-bottom: 3px solid #3b82f6;
            color: #3b82f6;
        }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        .kpi-card {
            background: white;
            color: #1f2937;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #f3f4f6;
        }
        .kpi-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }
        .kpi-card.success .text-3xl {
            color: #111827;
        }
        .kpi-card.warning .text-3xl {
            color: #111827;
        }
        .kpi-card.danger .text-3xl {
            color: #111827;
        }
        .kpi-card .text-3xl {
            color: #111827;
        }
        .kpi-card .text-sm {
            color: #6b7280;
        }
        .kpi-card .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }
        .kpi-card .kpi-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        .upload-zone {
            border: 3px dashed #cbd5e1;
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-zone:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }
        .upload-zone.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        .worker-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            margin: 0.25rem;
        }
        .badge-excellent {
            background: #d1fae5;
            color: #065f46;
        }
        .badge-normal {
            background: #dbeafe;
            color: #1e40af;
        }
        .badge-poor {
            background: #fef3c7;
            color: #92400e;
        }
        .badge-critical {
            background: #fee2e2;
            color: #991b1b;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            background: #f1f5f9;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
        }
        td {
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            background-color: #ffffff;
        }
        tr:hover {
            background: #f8fafc;
        }
        /* Pivot Table */
        .pivot-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.875rem;
        }
        
        .pivot-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
            background: #1f2937;
        }
        
        .pivot-table thead th {
            background: #1f2937 !important;
            color: white !important;
            padding: 0.5rem;
            text-align: center;
            font-size: 0.75rem;
            border: 1px solid #e5e7eb !important;
        }
        
        .pivot-table td {
            text-align: center;
            padding: 0.5rem;
            font-size: 0.875rem;
            border: 1px solid #e5e7eb !important;
            background-color: #ffffff !important;
        }
        
        .pivot-table .process-cell {
            font-weight: 700;
            font-size: 0.95rem;
            background-color: #334155 !important;
            color: white !important;
            text-align: left;
            border: 1px solid #e5e7eb !important;
        }
        
        .pivot-table .worker-cell {
            text-align: left;
            padding-left: 2rem;
            background-color: #f8fafc !important;
            font-weight: 500;
            border: 1px solid #e5e7eb !important;
        }
        .work-rate-high {
            background: #d1fae5;
            color: #065f46;
            font-weight: 600;
        }
        .work-rate-normal {
            background: #dbeafe;
            color: #1e40af;
        }
        .work-rate-low {
            background: #fef3c7;
            color: #92400e;
        }
        .work-rate-critical {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* Detailed Data Table */
        .detailed-data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.875rem;
        }
        
        .detailed-data-table thead {
            background: #1f2937;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .detailed-data-table thead th {
            background: #1f2937 !important;
            color: white !important;
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            border: 1px solid #e5e7eb !important;
        }
        
        .detailed-data-table tbody td {
            text-align: center;
            padding: 0.75rem;
            border: 1px solid #e5e7eb !important;
            background-color: #ffffff;
        }
        
        /* Outlier row styling - MUST come after default td styling */
        .detailed-data-table tbody tr.outlier-row td {
            background-color: #ffcdd2 !important;
        }
        
        .detailed-data-table tbody tr:hover {
            background-color: #f8fafc;
        }
        
        .detailed-data-table tbody tr:hover td {
            background-color: #f8fafc !important;
        }
        
        /* Maintain outlier styling on hover */
        .detailed-data-table tbody tr.outlier-row:hover td {
            background-color: #ef9a9a !important;
        }
        
        /* Modal table outlier styling */
        tr.modal-outlier-row td {
            background-color: #ffcdd2 !important;
        }
        
        tr.modal-outlier-row:hover td {
            background-color: #ef9a9a !important;
        }
        
        .filter-section {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        select, input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        select:focus, input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }
        .btn-secondary:hover {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        /* Checkbox dropdown styles */
        .checkbox-dropdown-btn {
            width: 100%;
            text-align: left;
            padding: 0.625rem 0.75rem;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .checkbox-dropdown-btn:hover {
            border-color: #94a3b8;
        }
        .checkbox-dropdown-btn:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.625rem 0.75rem;
            cursor: pointer;
            transition: background 0.15s;
            border-bottom: 1px solid #f1f5f9;
        }
        .checkbox-item:last-child {
            border-bottom: none;
        }
        .checkbox-item:hover {
            background: #eff6ff;
        }
        .checkbox-item input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            margin-right: 0.75rem;
            accent-color: #3b82f6;
            cursor: pointer;
        }
        .checkbox-item label {
            flex: 1;
            cursor: pointer;
            font-size: 0.875rem;
            color: #374151;
        }
        /* Radio button styles for Shift and Working Shift filters */
        input[type="radio"] {
            width: 1rem;
            height: 1rem;
            accent-color: #3b82f6;
            cursor: pointer;
            flex-shrink: 0;
        }
        .hidden {
            display: none !important;
        }
        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transition: width 0.3s;
        }
        /* Custom scrollbar styles */
        #excellentWorkers::-webkit-scrollbar,
        #poorWorkers::-webkit-scrollbar,
        #criticalWorkers::-webkit-scrollbar {
            width: 8px;
        }
        #excellentWorkers::-webkit-scrollbar-track,
        #poorWorkers::-webkit-scrollbar-track,
        #criticalWorkers::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        #excellentWorkers::-webkit-scrollbar-thumb {
            background: #10b981;
            border-radius: 4px;
        }
        #poorWorkers::-webkit-scrollbar-thumb {
            background: #f59e0b;
            border-radius: 4px;
        }
        #criticalWorkers::-webkit-scrollbar-thumb {
            background: #ef4444;
            border-radius: 4px;
        }
        #excellentWorkers::-webkit-scrollbar-thumb:hover,
        #poorWorkers::-webkit-scrollbar-thumb:hover,
        #criticalWorkers::-webkit-scrollbar-thumb:hover {
            opacity: 0.8;
        }
        #pivotReportView table {
            font-size: 0.875rem;
            min-width: 100%;
        }
        #pivotReportView th {
            position: sticky;
            top: 0;
            background: #1e293b;
            color: white;
            z-index: 10;
            font-weight: 600;
            padding: 0.75rem 0.5rem;
            text-align: center;
            border: 1px solid #475569;
        }
        #pivotReportView th:first-child {
            text-align: left !important;
            padding-left: 1rem !important;
        }
        #pivotReportView td {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid #e2e8f0;
            white-space: nowrap;
        }
        #pivotReportView .process-header {
            background: #334155;
            color: white;
            font-weight: 700;
            font-size: 0.95rem;
            text-align: left !important;
            padding-left: 1rem !important;
        }
        #pivotReportView .worker-cell {
            text-align: left !important;
            padding-left: 2rem !important;
            background: #f8fafc;
            font-weight: 500;
        }
        #pivotReportView .metric-wo {
            background: #eff6ff;
        }
        #pivotReportView .metric-time {
            background: #f0fdf4;
        }
        #pivotReportView .metric-rate {
            font-weight: 600;
        }
        #pivotReportView .rate-excellent {
            background: #d1fae5;
            color: #065f46;
        }
        #pivotReportView .rate-normal {
            background: #dbeafe;
            color: #1e40af;
        }
        #pivotReportView .rate-poor {
            background: #fef3c7;
            color: #92400e;
        }
        #pivotReportView .rate-critical {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Logo -->
        <div class="mb-4">
            <img src="/waiv-logo.png" alt="WAIV Logo" class="h-12">
        </div>
        
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">
                        Individual Performance Report
                    </h1>
                    <p class="text-gray-600 mt-2">
                        Individual Worker Productivity Reports & Performance Tracking
                    </p>
                </div>
                <!-- Metric Toggle Button -->
                <div class="flex items-center gap-4">
                    <button id="metricToggle" onclick="toggleMetric()" class="flex items-center gap-3 px-6 py-3 bg-white border-2 border-blue-500 rounded-lg hover:bg-blue-50 transition-all shadow-sm hover:shadow-md w-80 h-20">
                        <i id="metricIcon" class="fas fa-clock text-blue-500 text-xl"></i>
                        <div class="text-left">
                            <div id="metricLabel" class="text-sm font-semibold text-gray-800">Time Utilization</div>
                            <div id="metricDescription" class="text-xs text-gray-500">Actual work time usage rate</div>
                        </div>
                        <i class="fas fa-exchange-alt text-gray-400 ml-2"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-sm mb-6">
            <div class="flex border-b">
                <button class="tab-btn tab-active px-6 py-3 font-medium" data-tab="upload">
                    <i class="fas fa-file-upload mr-2"></i>Data Upload
                </button>
                <button class="tab-btn px-6 py-3 font-medium" data-tab="report">
                    <i class="fas fa-chart-bar mr-2"></i>Report
                </button>
                <button class="tab-btn px-6 py-3 font-medium" data-tab="mapping">
                    <i class="fas fa-sitemap mr-2"></i>Process Mapping
                </button>
                <button class="tab-btn px-6 py-3 font-medium" data-tab="manual">
                    <i class="fas fa-book mr-2"></i>User Guide
                </button>
                <button class="tab-btn px-6 py-3 font-medium" data-tab="changelog">
                    <i class="fas fa-history mr-2"></i>Update Log
                </button>
            </div>
        </div>

        <!-- Tab Contents -->
        <div id="uploadTab" class="tab-content">
            <!-- Upload File List Section -->
            <div class="card mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">
                        <i class="fas fa-database text-blue-600 mr-2"></i>
                        Saved Uploads
                    </h2>
                    <button id="refreshUploadsBtn" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded transition">
                        <i class="fas fa-sync-alt mr-1"></i>
                        Refresh
                    </button>
                </div>
                
                <div id="uploadsList" class="space-y-2">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-inbox text-4xl mb-2"></i>
                        <p>No saved uploads yet. Upload a file to get started.</p>
                    </div>
                </div>
            </div>
            
            <!-- Upload New File Section -->
            <div class="card">
                <h2 class="text-xl font-bold mb-4">
                    <i class="fas fa-file-upload text-blue-600 mr-2"></i>
                    Upload New File
                </h2>
                <div id="uploadZone" class="upload-zone">
                    <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">
                        Drag & Drop Excel File
                    </h3>
                    <p class="text-gray-500 mb-4">
                        Excel (.xlsx, .xls) file with worker time records
                    </p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" class="hidden">
                    <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-folder-open"></i>
                        Select File
                    </button>
                </div>
                
                <div id="uploadStatus" class="mt-4 hidden">
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
                        <div class="flex items-center">
                            <i class="fas fa-spinner fa-spin text-blue-500 mr-3"></i>
                            <span class="text-blue-700 font-medium">Processing file...</span>
                        </div>
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div id="uploadResult" class="mt-4 hidden">
                    <div class="bg-green-50 border-l-4 border-green-500 p-4">
                        <h4 class="font-semibold text-green-800 mb-2">
                            <i class="fas fa-check-circle mr-2"></i>
                            Upload Successful!
                        </h4>
                        <div class="text-sm text-green-700 space-y-1">
                            <p><strong>Processed Records:</strong> <span id="recordCount">0</span></p>
                            <p><strong>Date Range:</strong> <span id="dateRange">-</span></p>
                            <p><strong>Worker Count:</strong> <span id="workerCount">0</span></p>
                        </div>
                        <div class="mt-4 flex gap-3">
                            <button id="saveToDatabaseBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium transition">
                                <i class="fas fa-database mr-2"></i>
                                Save to Database
                            </button>
                            <span id="saveStatus" class="text-sm text-gray-600 flex items-center hidden">
                                <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                Saved to database
                            </span>
                        </div>
                    </div>
                </div>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Logo -->
        <div class="mb-4">
            <img src="/waiv-logo.png" alt="WAIV Logo" class="h-12">
        </div>
        
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">
                        Individual Performance Report
                    </h1>
                    <p class="text-gray-600 mt-2">
                        Individual Worker Productivity Reports & Performance Tracking
                    </p>
                </div>
                <!-- Metric Toggle Button -->
                <div class="flex items-center gap-4">
                    <button id="metricToggle" onclick="toggleMetric()" class="flex items-center gap-3 px-6 py-3 bg-white border-2 border-blue-500 rounded-lg hover:bg-blue-50 transition-all shadow-sm hover:shadow-md w-80 h-20">
                        <i id="metricIcon" class="fas fa-clock text-blue-500 text-xl"></i>
                        <div class="text-left">
                            <div id="metricLabel" class="text-sm font-semibold text-gray-800">Time Utilization</div>
                            <div id="metricDescription" class="text-xs text-gray-500">Actual work time usage rate</div>
                        </div>
                        <i class="fas fa-exchange-alt text-gray-400 ml-2"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-sm mb-6">
            <div class="flex border-b">
                <button class="tab-btn tab-active px-6 py-3 font-medium" data-tab="upload">
                    <i class="fas fa-file-upload mr-2"></i>Data Upload
                </button>
                <button class="tab-btn px-6 py-3 font-medium" data-tab="report">
                    <i class="fas fa-chart-bar mr-2"></i>Report
                </button>
                <button class="tab-btn px-6 py-3 font-medium" data-tab="mapping">
                    <i class="fas fa-sitemap mr-2"></i>Process Mapping
                </button>
                <button class="tab-btn px-6 py-3 font-medium" data-tab="manual">
                    <i class="fas fa-book mr-2"></i>User Guide
                </button>
                <button class="tab-btn px-6 py-3 font-medium" data-tab="changelog">
                    <i class="fas fa-history mr-2"></i>Update Log
                </button>
            </div>
        </div>

        <!-- Tab Contents -->
        <div id="uploadTab" class="tab-content">
            <!-- Upload File List Section -->
            <div class="card mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">
                        <i class="fas fa-database text-blue-600 mr-2"></i>
                        Saved Uploads
                    </h2>
                    <button id="refreshUploadsBtn" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded transition">
                        <i class="fas fa-sync-alt mr-1"></i>
                        Refresh
                    </button>
                </div>
                
                <div id="uploadsList" class="space-y-2">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-inbox text-4xl mb-2"></i>
                        <p>No saved uploads yet. Upload a file to get started.</p>
                    </div>
                </div>
            </div>
            
            <!-- Upload New File Section -->
            <div class="card">
                <h2 class="text-xl font-bold mb-4">
                    <i class="fas fa-file-upload text-blue-600 mr-2"></i>
                    Upload New File
                </h2>
                <div id="uploadZone" class="upload-zone">
                    <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">
                        Drag & Drop Excel File
                    </h3>
                    <p class="text-gray-500 mb-4">
                        Excel (.xlsx, .xls) file with worker time records
                    </p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" class="hidden">
                    <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-folder-open"></i>
                        Select File
                    </button>
                </div>
                
                <div id="uploadStatus" class="mt-4 hidden">
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
                        <div class="flex items-center">
                            <i class="fas fa-spinner fa-spin text-blue-500 mr-3"></i>
                            <span class="text-blue-700 font-medium">Processing file...</span>
                        </div>
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div id="uploadResult" class="mt-4 hidden">
                    <div class="bg-green-50 border-l-4 border-green-500 p-4">
                        <h4 class="font-semibold text-green-800 mb-2">
                            <i class="fas fa-check-circle mr-2"></i>
                            Upload Successful!
                        </h4>
                        <div class="text-sm text-green-700 space-y-1">
                            <p><strong>Processed Records:</strong> <span id="recordCount">0</span></p>
                            <p><strong>Date Range:</strong> <span id="dateRange">-</span></p>
                            <p><strong>Worker Count:</strong> <span id="workerCount">0</span></p>
                        </div>
                        <div class="mt-4 flex gap-3">
                            <button id="saveToDatabaseBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium transition">
                                <i class="fas fa-database mr-2"></i>
                                Save to Database
                            </button>
                            <span id="saveStatus" class="text-sm text-gray-600 flex items-center hidden">
                                <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                Saved to database
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="reportTab" class="tab-content hidden">
            <!-- Filters -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">
                    <i class="fas fa-filter text-blue-600 mr-2"></i>
                    Filters
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Shift</label>
                        <div class="relative">
                            <button id="filterShiftDisplay" class="w-full text-left px-3 py-2 bg-white border border-gray-300 rounded-md hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" onclick="toggleCheckboxDropdown('shift')">
                                <span class="text-gray-500">All</span>
                                <i class="fas fa-chevron-down float-right mt-1 text-gray-400"></i>
                            </button>
                            <div id="filterShiftDropdown" class="hidden absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg">
                                <div class="p-2">
                                    <label class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer rounded border-b border-gray-100">
                                        <input type="radio" name="shift" value="" class="mr-3" checked onchange="updateSingleSelect('shift', '')">
                                        <span class="text-sm text-gray-700">All</span>
                                    </label>
                                    <label class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer rounded border-b border-gray-100">
                                        <input type="radio" name="shift" value="A" class="mr-3" onchange="updateSingleSelect('shift', 'A')">
                                        <span class="text-sm text-gray-700">A Shift</span>
                                    </label>
                                    <label class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer rounded border-b border-gray-100">
                                        <input type="radio" name="shift" value="B" class="mr-3" onchange="updateSingleSelect('shift', 'B')">
                                        <span class="text-sm text-gray-700">B Shift</span>
                                    </label>
                                    <label class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">
                                        <input type="radio" name="shift" value="C" class="mr-3" onchange="updateSingleSelect('shift', 'C')">
                                        <span class="text-sm text-gray-700">C Shift</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Working Date (Multi)</label>
                        <div class="relative">
                            <button id="filterWorkingDayDisplay" class="w-full text-left px-3 py-2 bg-white border border-gray-300 rounded-md hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" onclick="toggleCheckboxDropdown('workingDay')">
                                <span class="text-gray-500">Select dates...</span>
                                <i class="fas fa-chevron-down float-right mt-1 text-gray-400"></i>
                            </button>
                            <div id="filterWorkingDayDropdown" class="hidden absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-80 overflow-y-auto">
                                <!-- Month group buttons will be added here by JavaScript -->
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Working Shift</label>
                        <div class="relative">
                            <button id="filterWorkingShiftDisplay" class="w-full text-left px-3 py-2 bg-white border border-gray-300 rounded-md hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" onclick="toggleCheckboxDropdown('workingShift')">
                                <span class="text-gray-500">All</span>
                                <i class="fas fa-chevron-down float-right mt-1 text-gray-400"></i>
                            </button>
                            <div id="filterWorkingShiftDropdown" class="hidden absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg">
                                <div class="p-2">
                                    <label class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer rounded border-b border-gray-100">
                                        <input type="radio" name="workingShift" value="" class="mr-3" checked onchange="updateSingleSelect('workingShift', '')">
                                        <span class="text-sm text-gray-700">All</span>
                                    </label>
                                    <label class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer rounded border-b border-gray-100">
                                        <input type="radio" name="workingShift" value="Day" class="mr-3" onchange="updateSingleSelect('workingShift', 'Day')">
                                        <span class="text-sm text-gray-700">Day</span>
                                    </label>
                                    <label class="flex items-center px-3 py-2 hover:bg-blue-50 cursor-pointer rounded">
                                        <input type="radio" name="workingShift" value="Night" class="mr-3" onchange="updateSingleSelect('workingShift', 'Night')">
                                        <span class="text-sm text-gray-700">Night</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Category (FO Desc 2)</label>
                        <div class="relative">
                            <button id="filterCategoryDisplay" class="w-full text-left px-3 py-2 bg-white border border-gray-300 rounded-md hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" onclick="toggleCheckboxDropdown('category')">
                                <span class="text-gray-500">Select...</span>
                                <i class="fas fa-chevron-down float-right mt-1 text-gray-400"></i>
                            </button>
                            <div id="filterCategoryDropdown" class="hidden absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Process (FO Desc 3)</label>
                        <div class="relative">
                            <button id="filterProcessDisplay" class="w-full text-left px-3 py-2 bg-white border border-gray-300 rounded-md hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" onclick="toggleCheckboxDropdown('process')">
                                <span class="text-gray-500">Select...</span>
                                <i class="fas fa-chevron-down float-right mt-1 text-gray-400"></i>
                            </button>
                            <div id="filterProcessDropdown" class="hidden absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Worker</label>
                        <div class="relative">
                            <button id="filterWorkerDisplay" class="w-full text-left px-3 py-2 bg-white border border-gray-300 rounded-md hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" onclick="toggleCheckboxDropdown('worker')">
                                <span class="text-gray-500">Select...</span>
                                <i class="fas fa-chevron-down float-right mt-1 text-gray-400"></i>
                            </button>
                            <div id="filterWorkerDropdown" class="hidden absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-80 overflow-hidden">
                                <!-- Search Input -->
                                <div class="sticky top-0 bg-white p-2 border-b border-gray-200">
                                    <input type="text" id="workerSearchInput" 
                                           placeholder="Search workers..." 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                           oninput="filterWorkerList()"
                                           onclick="event.stopPropagation()">
                                </div>
                                <!-- Worker List -->
                                <div id="filterWorkerList" class="max-h-60 overflow-y-auto">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4 flex gap-3">
                    <button id="applyFilterBtn" class="btn btn-primary">
                        <i class="fas fa-search"></i>
                        Apply Filters
                    </button>
                    <button id="resetFilterBtn" class="btn btn-secondary">
                        <i class="fas fa-redo"></i>
                        Reset
                    </button>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="kpi-card">
                    <div class="text-sm mb-1">Total Workers</div>
                    <div class="text-3xl font-bold" id="kpiWorkers">0</div>
                </div>
                <div class="kpi-card success">
                    <div class="text-sm mb-1">Valid Work Orders</div>
                    <div class="text-3xl font-bold" id="kpiValidWO">0</div>
                </div>
                <div class="kpi-card warning">
                    <div class="text-sm mb-1" id="kpiTotalTimeLabel">Total Work Time (min)</div>
                    <div class="text-3xl font-bold" id="kpiTotalMinutes">0</div>
                </div>
                <div class="kpi-card" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 2px solid #0284c7; box-shadow: 0 4px 6px -1px rgba(2, 132, 199, 0.1), 0 2px 4px -1px rgba(2, 132, 199, 0.06);">
                    <div class="text-sm mb-1" style="color: #0369a1; font-weight: 600;" id="kpiAvgRateLabel">Average Rate</div>
                    <div class="text-3xl font-bold" id="kpiAvgWorkRate" style="color: #1f2937;">0%</div>
                </div>
            </div>
            
            <!-- Outlier Threshold Control -->
            <div id="outlierThresholdControl" class="mb-6 p-4 bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg">
                <div class="flex items-center justify-between gap-4">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-filter text-orange-600 text-lg"></i>
                        <div>
                            <label class="text-sm font-semibold text-gray-800">Outlier Threshold</label>
                            <p class="text-xs text-gray-600">W/O with rate > threshold will be auto-filtered</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="number" id="outlierThresholdInput" 
                               value="1000" min="100" max="10000" step="100"
                               class="w-24 px-3 py-2 border border-gray-300 rounded-md text-center font-semibold focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <span class="text-lg font-bold text-gray-700">%</span>
                        <button id="applyThresholdBtn" class="px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 transition font-semibold text-sm">
                            <i class="fas fa-sync-alt mr-1"></i>
                            Apply
                        </button>
                    </div>
                </div>
            </div>

            <!-- Performance Bands -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="card">
                    <div class="flex justify-between items-center mb-3">
                        <h4 id="excellentTitle" class="font-bold text-green-700">
                            <i class="fas fa-trophy mr-2"></i>
                            <span id="excellentRange">Excellent Workers (≥80%)</span>
                        </h4>
                        <div class="flex gap-2">
                            <button onclick="sortPerformanceBand('excellent', 'asc')" class="text-xs px-2 py-1 bg-green-100 hover:bg-green-200 text-green-700 rounded transition" title="오름차순 정렬">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button onclick="sortPerformanceBand('excellent', 'desc')" class="text-xs px-2 py-1 bg-green-100 hover:bg-green-200 text-green-700 rounded transition" title="내림차순 정렬">
                                <i class="fas fa-arrow-down"></i>
                            </button>
                        </div>
                    </div>
                    <div id="excellentWorkers" class="min-h-[60px] max-h-[300px] overflow-y-auto">
                        <p class="text-gray-500 text-sm">No data available</p>
                    </div>
                </div>
                <div class="card">
                    <div class="flex justify-between items-center mb-3">
                        <h4 id="normalTitle" class="font-bold text-blue-700">
                            <i class="fas fa-check-circle mr-2"></i>
                            <span id="normalRange">Normal Workers (50~79%)</span>
                        </h4>
                        <div class="flex gap-2">
                            <button onclick="sortPerformanceBand('normal', 'asc')" class="text-xs px-2 py-1 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded transition" title="오름차순 정렬">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button onclick="sortPerformanceBand('normal', 'desc')" class="text-xs px-2 py-1 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded transition" title="내림차순 정렬">
                                <i class="fas fa-arrow-down"></i>
                            </button>
                        </div>
                    </div>
                    <div id="normalWorkers" class="min-h-[60px] max-h-[300px] overflow-y-auto">
                        <p class="text-gray-500 text-sm">No data available</p>
                    </div>
                </div>
                <div class="card">
                    <div class="flex justify-between items-center mb-3">
                        <h4 id="poorTitle" class="font-bold text-orange-700">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            <span id="poorRange">Poor Workers (30~49%)</span>
                        </h4>
                        <div class="flex gap-2">
                            <button onclick="sortPerformanceBand('poor', 'asc')" class="text-xs px-2 py-1 bg-orange-100 hover:bg-orange-200 text-orange-700 rounded transition" title="오름차순 정렬">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button onclick="sortPerformanceBand('poor', 'desc')" class="text-xs px-2 py-1 bg-orange-100 hover:bg-orange-200 text-orange-700 rounded transition" title="내림차순 정렬">
                                <i class="fas fa-arrow-down"></i>
                            </button>
                        </div>
                    </div>
                    <div id="poorWorkers" class="min-h-[60px] max-h-[300px] overflow-y-auto">
                        <p class="text-gray-500 text-sm">No data available</p>
                    </div>
                </div>
                <div class="card">
                    <div class="flex justify-between items-center mb-3">
                        <h4 id="criticalTitle" class="font-bold text-red-700">
                            <i class="fas fa-times-circle mr-2"></i>
                            At-Risk Workers (&lt;30%)
                        </h4>
                        <div class="flex gap-2">
                            <button onclick="sortPerformanceBand('critical', 'asc')" class="text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded transition" title="오름차순 정렬">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button onclick="sortPerformanceBand('critical', 'desc')" class="text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded transition" title="내림차순 정렬">
                                <i class="fas fa-arrow-down"></i>
                            </button>
                        </div>
                    </div>
                    <div id="criticalWorkers" class="min-h-[60px] max-h-[300px] overflow-y-auto">
                        <p class="text-gray-500 text-sm">No data available</p>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">Average Work Rate by Process</h3>
                    <div style="height: 300px;">
                        <canvas id="processChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">Worker Performance Distribution</h3>
                    <div style="height: 300px;">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Pivot Style Report Table -->
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">
                        <i class="fas fa-table text-purple-600 mr-2"></i>
                        Worker Performance Report by Date
                    </h3>
                    <button id="toggleViewBtn" class="btn btn-secondary text-sm">
                        <i class="fas fa-exchange-alt mr-1"></i>
                        Switch to Detail View
                    </button>
                </div>
                <div id="pivotReportView" class="overflow-x-auto max-h-[600px] overflow-y-auto">
                    <p class="text-gray-500 text-center py-8">데이터를 업로드하고 Filters를 적용해주세요</p>
                </div>
                
                <!-- Pivot Report Glossary -->
                <div id="pivotGlossary" class="mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="text-xs text-gray-500 leading-relaxed">
                        <!-- Dynamic content will be inserted by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">
                        <i class="fas fa-table text-blue-600 mr-2"></i>
                        Detailed Data
                    </h3>
                    <div class="flex items-center gap-3">
                        <!-- Worker Search -->
                        <div class="relative">
                            <input type="text" id="workerSearchInput" 
                                   placeholder="Search worker..." 
                                   class="pl-9 pr-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <button id="toggleViewBtn2" class="btn btn-secondary text-sm">
                            <i class="fas fa-exchange-alt mr-1"></i>
                            Switch to Date Report
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto max-h-[600px] overflow-y-auto">
                    <table id="dataTable" class="detailed-data-table">
                        <thead class="sticky top-0 z-10">
                            <tr>
                                <th>Worker</th>
                                <th>Process (FO Desc 3)</th>
                                <th>Work Date</th>
                                <th>Shift</th>
                                <th>Day/Night</th>
                                <th>Work Time (min)</th>
                                <th>Work Count</th>
                                <th id="workRateHeader">Work Rate</th>
                                <th>Performance Grade</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                            <tr>
                                <td colspan="9" class="text-center text-gray-500">Please upload data</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


        <div id="mappingTab" class="tab-content hidden">
            <div class="card">
                <h2 class="text-xl font-bold mb-4">
                    <i class="fas fa-sitemap text-purple-600 mr-2"></i>
                    Process Mapping Management
                </h2>
                <p class="text-gray-600 mb-4">
                    Map Raw data's FD Desc or FO Desc to higher-level Process (FO Desc 2, FO Desc 3).
                </p>
                
                <div class="mb-6">
                    <h3 class="font-semibold mb-3">Add New Mapping</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
                        <input type="text" id="newFDDesc" placeholder="FD Desc / FO Desc" class="p-2 border rounded">
                        <input type="text" id="newFODesc2" placeholder="FO Desc 2" class="p-2 border rounded">
                        <input type="text" id="newFODesc3" placeholder="FO Desc 3" class="p-2 border rounded">
                        <input type="number" id="newSeq" placeholder="Sequence (Seq)" class="p-2 border rounded">
                    </div>
                    <button id="addMappingBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Add Mapping
                    </button>
                </div>

                <div class="overflow-x-auto">
                    <table id="mappingTable">
                        <thead>
                            <tr>
                                <th class="cursor-pointer hover:bg-gray-200 transition" onclick="sortMappingTable('fdDesc')">
                                    FD Desc / FO Desc <i class="fas fa-sort text-gray-400"></i>
                                </th>
                                <th class="cursor-pointer hover:bg-gray-200 transition" onclick="sortMappingTable('foDesc2')">
                                    FO Desc 2 <i class="fas fa-sort text-gray-400"></i>
                                </th>
                                <th class="cursor-pointer hover:bg-gray-200 transition" onclick="sortMappingTable('foDesc3')">
                                    FO Desc 3 <i class="fas fa-sort text-gray-400"></i>
                                </th>
                                <th class="cursor-pointer hover:bg-gray-200 transition" onclick="sortMappingTable('seq')">
                                    Sequence (Seq) <i class="fas fa-sort text-gray-400"></i>
                                </th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="mappingTableBody">
                            <tr>
                                <td colspan="5" class="text-center text-gray-500">No mapping data available</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="manualTab" class="tab-content hidden">
            <div class="card">
                <h2 class="text-xl font-bold mb-4">
                    <i class="fas fa-book text-indigo-600 mr-2"></i>
                    User Guide
                </h2>
                
                <!-- v3.1.0 Important Notice -->
                <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-triangle text-red-500 text-xl mr-3 mt-1"></i>
                        <div>
                            <h3 class="text-red-800 font-bold mb-2">⚠️ Important: v3.1.0 Upgrade Notice</h3>
                            <p class="text-red-700 text-sm mb-2">
                                <strong>Data saved before v3.1.0 will show Efficiency as 0%.</strong>
                            </p>
                            <ul class="list-disc list-inside text-red-700 text-sm space-y-1 ml-4">
                                <li><strong>Cause</strong>: Database schema lacked worker_st and worker_rate_pct columns</li>
                                <li><strong>Solution</strong>: Delete old uploads and re-upload Excel files</li>
                                <li><strong>Action</strong>: Go to "Saved Uploads" → Click "Delete" button on each old upload</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Left Column: Instructions -->
                    <div class="space-y-6">
                        <section>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">1. Data Upload & Save</h3>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                <li><strong>Upload Excel file</strong> (.xlsx, .xls) with <strong>'Raw'</strong> sheet</li>
                                <li>Drag & drop file or click 'Select File' button</li>
                                <li>Review the processed data and reports</li>
                                <li><strong>Click "Save to Database"</strong> to store data in Cloudflare D1</li>
                                <li><strong>Tip:</strong> Include ShiftCalendar sheet in Excel for Shift (A/B/C) filtering</li>
                            </ul>
                        </section>

                        <section>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">2. Load Saved Data</h3>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                <li>View <strong>Saved Uploads</strong> list in Upload tab</li>
                                <li><strong>Click any card</strong> to load saved data</li>
                                <li>Automatically switches to Report tab after loading</li>
                                <li>Delete uploads using the <strong>Delete button</strong> on each card</li>
                            </ul>
                        </section>

                        <section>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">3. Switch Metric Mode</h3>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                <li><strong>Toggle Button</strong>: Click to switch between Utilization & Efficiency</li>
                                <li><strong>Utilization Rate</strong>: Measures time usage (Actual work time / Available time × 100)</li>
                                <li><strong>Efficiency Rate</strong>: Measures productivity (Assigned standard time / Actual time × 100)</li>
                                <li><strong>Note</strong>: Reports, bands, and charts update automatically</li>
                            </ul>
                        </section>

                        <section>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">4. Apply Filters</h3>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                <li><strong>Shift Filter</strong>: A Shift / B Shift / C Shift</li>
                                <li><strong>Date Filter</strong>: Select by individual dates, weeks (WK#), or months</li>
                                <li><strong>Working Shift</strong>: Day / Night</li>
                                <li><strong>Category</strong>: BT Process, DS, BT Complete, WT, IM, etc.</li>
                                <li><strong>Process</strong>: Specific processes (FO Desc 3)</li>
                                <li><strong>Worker</strong>: Individual workers (searchable)</li>
                                <li><strong>Click "Apply Filter"</strong> to update reports</li>
                            </ul>
                        </section>

                        <section>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">5. Required Headers (Raw Sheet)</h3>
                            <p class="text-gray-700 mb-2">Raw sheet must include these headers:</p>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                <li><strong>Worker Name</strong>: Worker name</li>
                                <li><strong>FO Desc</strong> or <strong>FD Desc</strong>: Process description</li>
                                <li><strong>Start Datetime</strong>: Work start time</li>
                                <li><strong>Worker Act</strong>: Work time (minutes)</li>
                                <li><strong>Result Cnt</strong>: Work result count (X = completed)</li>
                            </ul>
                        </section>

                        <section>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">6. Performance Grades</h3>
                            <p class="text-gray-700 mb-2"><strong>Utilization Rate Bands:</strong></p>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                <li><span class="worker-badge badge-excellent">Excellent</span>: ≥ 80%</li>
                                <li><span class="worker-badge badge-normal">Normal</span>: 50-79%</li>
                                <li><span class="worker-badge badge-poor">Poor</span>: 30-49%</li>
                                <li><span class="worker-badge badge-critical">At-Risk</span>: &lt; 30%</li>
                            </ul>
                            <p class="text-gray-700 mb-2 mt-3"><strong>Efficiency Rate Bands:</strong></p>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                <li><span class="worker-badge badge-excellent">Excellent</span>: ≥ 120%</li>
                                <li><span class="worker-badge badge-normal">Normal</span>: 100-119%</li>
                                <li><span class="worker-badge badge-poor">Poor</span>: 80-99%</li>
                                <li><span class="worker-badge badge-critical">At-Risk</span>: &lt; 80%</li>
                            </ul>
                            <p class="text-sm text-gray-600 mt-3">
                                <strong>⚠️ Data Quality:</strong> Workers with rates >1000% are filtered from aggregated reports (console logs show filtered workers)
                            </p>
                        </section>

                        <section>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">7. Worker Detail Modal</h3>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                <li><strong>Click any worker card</strong> to view detailed information</li>
                                <li>View daily work time trends (line chart)</li>
                                <li>See hourly work distribution (donut chart)</li>
                                <li>Check detailed work records (date, shift, process, time)</li>
                            </ul>
                        </section>
                    </div>

                    <!-- Right Column: Shift Calendar -->
                    <div>
                        <section>
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">
                                <i class="fas fa-calendar-alt text-blue-600 mr-2"></i>
                                <span id="calendarMonthTitle">February 2026</span> - Shift Calendar
                            </h3>
                            
                            <!-- Month Navigation -->
                            <div class="flex gap-2 mb-3">
                                <button id="calendarPrevMonth" class="px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50 transition">
                                    <i class="fas fa-chevron-left"></i> Prev
                                </button>
                                <button id="calendarNextMonth" class="px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50 transition">
                                    Next <i class="fas fa-chevron-right"></i>
                                </button>
                                <div class="flex-1"></div>
                                <button id="calendarFeb" class="px-3 py-1 text-sm bg-blue-100 border border-blue-300 rounded hover:bg-blue-200 transition font-semibold">
                                    Feb
                                </button>
                                <button id="calendarMar" class="px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50 transition">
                                    Mar
                                </button>
                                <button id="calendarApr" class="px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50 transition">
                                    Apr
                                </button>
                            </div>
                            
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                                <div class="grid grid-cols-7 gap-1 text-center text-xs font-semibold mb-2">
                                    <div class="text-gray-600">Sun</div>
                                    <div class="text-gray-600">Mon</div>
                                    <div class="text-gray-600">Tue</div>
                                    <div class="text-gray-600">Wed</div>
                                    <div class="text-gray-600">Thu</div>
                                    <div class="text-gray-600">Fri</div>
                                    <div class="text-gray-600">Sat</div>
                                </div>
                                <div id="shiftCalendarGrid" class="grid grid-cols-7 gap-1">
                                    <!-- Calendar will be generated by JavaScript -->
                                </div>
                            </div>
                            <div class="mt-4 space-y-2">
                                <div class="flex items-center gap-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-4 h-4 rounded" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);"></div>
                                        <span class="text-sm text-gray-700"><strong>A Shift</strong> - Day</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-4 h-4 rounded" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);"></div>
                                        <span class="text-sm text-gray-700"><strong>B Shift</strong> - Day</span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-4 h-4 rounded" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);"></div>
                                        <span class="text-sm text-gray-700"><strong>C Shift</strong> - Night</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-4 h-4 rounded bg-gray-200"></div>
                                        <span class="text-sm text-gray-700">No shift</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-600 mt-3">
                                    <strong>Note:</strong> Day shift (06:00-18:00), Night shift (18:00-06:00)
                                </p>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>

        <!-- Update Log Tab -->
        <div id="changelogTab" class="tab-content hidden">
            <div class="card">
                <h2 class="text-xl font-bold mb-4">
                    <i class="fas fa-history text-purple-600 mr-2"></i>
                    Update Log
                </h2>
                
                <div class="space-y-6">
                    <!-- Version 3.1.0 -->
                    <div class="border-l-4 border-red-600 pl-4">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="text-lg font-bold text-gray-800">Version 3.1.0</h3>
                            <span class="px-3 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded-full">Critical Fix</span>
                            <span class="text-xs text-gray-500">2026-02-21</span>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-red-700 mb-2">
                                    <i class="fas fa-database mr-2"></i>DB Save/Load Efficiency Fields Fix
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Database Schema Update</strong>: Added worker_st and worker_rate_pct columns</li>
                                    <li><strong>Migration 0002</strong>: Applied to both local and production databases</li>
                                    <li><strong>Backend API</strong>: Now correctly saves/loads Worker S/T and Worker Rate(%) fields</li>
                                    <li><strong>Frontend</strong>: loadUploadById restores all efficiency fields properly</li>
                                    <li><strong>Result</strong>: Efficiency now displays correctly after DB load (no more 0%)</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-red-700 mb-2">
                                    <i class="fas fa-chart-area mr-2"></i>Hourly Work Distribution Chart Fix
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li>Fixed field name references: Worker S/T, Worker Rate(%) (not S_T, Rate)</li>
                                    <li>Chart now displays hourly efficiency correctly in Worker Detail modal</li>
                                    <li>Improved data filtering and aggregation logic</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-red-700 mb-2">
                                    <i class="fas fa-filter mr-2"></i>Modal Outlier Filtering Enhancement
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Fixed</strong>: Worker Detail modal now correctly filters outliers</li>
                                    <li><strong>Result</strong>: Main page % = Modal % (perfect consistency)</li>
                                    <li>Outlier Threshold properly reflected in summary calculations</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-red-700 mb-2">
                                    <i class="fas fa-terminal mr-2"></i>Debug Logging Added
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li>DB load process tracking (rawData restoration)</li>
                                    <li>processData efficiency fields validation</li>
                                    <li>Warning logs for Worker S/T=0 or Rate=0 (first 5 records)</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-red-700 mb-2">
                                    <i class="fas fa-paint-brush mr-2"></i>UI/UX Improvements
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Performance Band Titles</strong>: Removed "Workers" suffix (Excellent, Normal, Poor, At-Risk)</li>
                                    <li><strong>Professional Footer</strong>: Added with WAIV branding, CS WIND copyright, developer info</li>
                                    <li><strong>Footer Design</strong>: Gradient background, 3-column layout, version badge (v3.1.0)</li>
                                </ul>
                            </div>
                            
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3 mt-3">
                                <p class="text-sm text-red-800">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    <strong>Breaking Change:</strong> Data saved before v3.1.0 has worker_st=0, worker_rate_pct=0. 
                                    Delete old uploads and re-upload Excel files for correct efficiency calculations.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Version 3.0.0 -->
                    <div class="border-l-4 border-purple-600 pl-4">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="text-lg font-bold text-gray-800">Version 3.0.0</h3>
                            <span class="px-3 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded-full">Major Update</span>
                            <span class="text-xs text-gray-500">2026-02-20</span>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-purple-700 mb-2">
                                    <i class="fas fa-chart-line mr-2"></i>Two New Performance Metrics
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Time Utilization Rate</strong>: Actual work time / Available time (shifts × 660min) × 100%</li>
                                    <li><strong>Work Efficiency Rate</strong>: Assigned standard time / Actual time × 100%</li>
                                    <li>Toggle button to switch between metrics with visual indicators</li>
                                    <li>Performance bands updated: Excellent, Good, Normal, Poor, Critical</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-purple-700 mb-2">
                                    <i class="fas fa-filter mr-2"></i>Enhanced Data Filtering
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li>Automatic exclusion of Rework records (W column = true)</li>
                                    <li>Filter out records with Worker S/T ≤ 0</li>
                                    <li>New columns parsed: Worker S/T (T), Worker Rate(%) (U), Rework (W)</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-purple-700 mb-2">
                                    <i class="fas fa-user-circle mr-2"></i>Worker Detail Modal Enhancements
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Time Utilization View</strong>: Daily/hourly charts in minutes (blue theme), overlap removal highlighted</li>
                                    <li><strong>Work Efficiency View</strong>: Daily/hourly charts in % (purple theme), efficiency color-coded</li>
                                    <li>Dynamic table headers based on selected metric</li>
                                    <li>Separate calculation logic for each metric type</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-purple-700 mb-2">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>Breaking Changes
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li>Removed old "Valid-only" work rate calculation</li>
                                    <li>Replaced single metric with dual-metric system</li>
                                    <li>Performance band thresholds completely redesigned</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-purple-700 mb-2">
                                    <i class="fas fa-bug mr-2"></i>Bug Fixes
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li>Fixed overlap removal logic to work per worker (not merged across workers)</li>
                                    <li>Corrected Worker Rate(%) handling (0% is valid, not missing)</li>
                                    <li>Fixed performance band gaps (no empty ranges)</li>
                                </ul>
                            </div>
                            
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 mt-3">
                                <p class="text-sm text-purple-800">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    <strong>Validation:</strong> Tested with R018Worker_2026-02-18 Excel file (27,026 rows, 831 rework records excluded)
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Version 2.6.0 -->
                    <div class="border-l-4 border-green-500 pl-4">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="text-lg font-bold text-gray-800">Version 2.6.0</h3>
                            <span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full">Previous</span>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-green-700 mb-2">
                                    <i class="fas fa-calendar-week mr-2"></i>Week Filter
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Week Selection</strong>: Added week-based date filtering with week number display
                                        <br><span class="text-sm text-gray-600 ml-4">• Format: WK7: 02-10 ~ 02-16</span>
                                        <br><span class="text-sm text-gray-600 ml-4">• ISO Week calculation (Monday-based)</span>
                                    </li>
                                    <li><strong>Quick Selection</strong>: Month and Week buttons for fast date selection</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-blue-700 mb-2">
                                    <i class="fas fa-mouse-pointer mr-2"></i>Filter UX Improvements
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Visual Feedback</strong>: Enhanced hover effects (dark color + white text)</li>
                                    <li><strong>Active State</strong>: Click animation (scale-95, darker color)</li>
                                    <li><strong>Auto-close Dropdowns</strong>: Automatically close after selection</li>
                                    <li><strong>Filter State Persistence</strong>: Maintain selections when re-applying filters</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-orange-700 mb-2">
                                    <i class="fas fa-calculator mr-2"></i>Average Work Rate Fix
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Calculation Update</strong>: Changed from worker count to total shift count
                                        <br><span class="text-sm text-gray-600 ml-4">• Before: totalMinutes / workerCount / 660 × 100 ❌</span>
                                        <br><span class="text-sm text-gray-600 ml-4">• After: totalMinutes / totalShifts / 660 × 100 ✅</span>
                                        <br><span class="text-sm text-gray-600 ml-4">• Fixed: 457% → ~65% (correct range)</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-purple-700 mb-2">
                                    <i class="fas fa-table mr-2"></i>Pivot Table Enhancement
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Cell Merge</strong>: Worker Name header with rowspan for cleaner layout</li>
                                    <li><strong>Sticky Header</strong>: Fixed header during scroll</li>
                                    <li><strong>Clean Design</strong>: Simplified 2-row header structure</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Version 2.1.0 -->
                    <div class="border-l-4 border-purple-500 pl-4">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="text-lg font-bold text-gray-800">Version 2.1.0</h3>
                            <span class="px-3 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded-full">2026-02-18</span>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-green-700 mb-2">
                                    <i class="fas fa-check-circle mr-2"></i>Major Fixes
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Work Rate Calculation Fix</strong>: Changed from record count to worker count
                                        <br><span class="text-sm text-gray-600 ml-4">• Before: totalMinutes / recordCount / 660 × 100 ❌</span>
                                        <br><span class="text-sm text-gray-600 ml-4">• After: totalMinutes / workerCount / 660 × 100 ✅</span>
                                    </li>
                                    <li><strong>Valid Records Only</strong>: Only sum workerActMins for Result Cnt = 'X'
                                        <br><span class="text-sm text-gray-600 ml-4">• Both main report and detail modal now consistent</span>
                                    </li>
                                    <li><strong>Shift Counting Logic</strong>: Use workingDay + workingShift for proper O/T handling
                                        <br><span class="text-sm text-gray-600 ml-4">• Fixed: Overnight shifts and overtime now counted as single shift</span>
                                        <br><span class="text-sm text-gray-600 ml-4">• Formula: Work Rate = validMinutes / (660 × shiftCount) × 100</span>
                                    </li>
                                    <li><strong>Process Sequence Mapping</strong>: Pre-Blasting moved to front (Seq: 0)
                                        <br><span class="text-sm text-gray-600 ml-4">• Fixed: DB mappings merged with default mappings</span>
                                        <br><span class="text-sm text-gray-600 ml-4">• Chart order: FO Desc 2 category → Seq within category</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-blue-700 mb-2">
                                    <i class="fas fa-plus-circle mr-2"></i>Improvements
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Analysis Page Removed</strong>: Simplified UI by removing redundant analysis page</li>
                                    <li><strong>Export/Import JSON Removed</strong>: Now fully database-based with Cloudflare D1</li>
                                    <li><strong>Chart Compatibility</strong>: Fixed Chart.js v3+ compatibility (horizontalBar → bar with indexAxis: 'y')</li>
                                    <li><strong>Debug Logging</strong>: Added detailed console logs for shift calculation and work rate</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Version 3.0.0 -->
                    <div class="border-l-4 border-purple-500 pl-4">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="text-lg font-bold text-gray-800">Version 3.0.0</h3>
                            <span class="px-3 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded-full">2026-02-21</span>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-purple-700 mb-2">
                                    <i class="fas fa-star mr-2"></i>Two Metric System
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Dual Metric Mode</strong>: Toggle between Utilization Rate & Efficiency Rate</li>
                                    <li><strong>Utilization Rate</strong>: Actual work time / Available time × 100</li>
                                    <li><strong>Efficiency Rate</strong>: Assigned standard time / Actual time × 100</li>
                                    <li><strong>Dynamic Headers</strong>: Table headers adapt to current metric type</li>
                                    <li><strong>Performance Bands</strong>: Separate thresholds for each metric</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-green-700 mb-2">
                                    <i class="fas fa-filter mr-2"></i>Data Quality
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Outlier Filtering</strong>: Automatically filters workers with rates >1000% from aggregated reports</li>
                                    <li><strong>Note</strong>: Individual work orders are preserved; only worker-level totals are filtered</li>
                                    <li><strong>Threshold</strong>: Configurable (default: 1000%)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-l-4 border-blue-500 pl-4">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="text-lg font-bold text-gray-800">Version 2.0.0</h3>
                            <span class="px-3 py-1 bg-blue-100 text-blue-700 text-xs font-semibold rounded-full">2026-02-17</span>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-green-700 mb-2">
                                    <i class="fas fa-star mr-2"></i>Major Features
                                </h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                    <li><strong>Database Integration</strong>: Cloudflare D1 for persistent storage</li>
                                    <li><strong>Time Overlap Detection</strong>: Automatic removal of overlapping work intervals</li>
                                    <li><strong>Performance Bands</strong>: Excellent (≥80%), Normal (50-80%), Poor (30-50%), Critical (<30%)</li>
                                    <li><strong>Worker Detail Modal</strong>: Daily trends, hourly distribution, and detailed records</li>
                                    <li><strong>Process Mapping</strong>: Flexible FD Desc → FO Desc 2/3 mapping with sequence ordering</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Version 1.0.0 -->
                    <div class="border-l-4 border-gray-400 pl-4">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="text-lg font-bold text-gray-800">Version 1.0.0</h3>
                            <span class="px-3 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded-full">2026-02-01</span>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-2">
                                <i class="fas fa-rocket mr-2"></i>Initial Release
                            </h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                <li><strong>Excel Upload</strong>: Support for .xlsx/.xls files</li>
                                <li><strong>Basic Reports</strong>: Worker performance and process analysis</li>
                                <li><strong>Charts & Visualizations</strong>: Performance bands, process distribution</li>
                                <li><strong>Shift Calendar</strong>: A/B/C shift management</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Technical Notes -->
                <div class="mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <h3 class="font-semibold text-gray-800 mb-2">
                        <i class="fas fa-code mr-2"></i>Technical Notes
                    </h3>
                    <ul class="list-disc list-inside text-gray-600 text-sm space-y-1 ml-4">
                        <li><strong>Framework</strong>: Hono (Cloudflare Workers) + Vanilla JavaScript</li>
                        <li><strong>Database</strong>: Cloudflare D1 (SQLite)</li>
                        <li><strong>Charts</strong>: Chart.js v3+</li>
                        <li><strong>Deployment</strong>: Cloudflare Pages</li>
                        <li><strong>Version Control</strong>: Git + GitHub</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="mappingTab" class="tab-content hidden">
                    </section>

                    <section>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">6. Process 매핑</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                            <li>Process 매핑 탭에서 FD Desc/FO Desc를 상위 Process으로 매핑합니다.</li>
                            <li>매핑 데이터는 JSON 내보내기 시 함께 저장됩니다.</li>
                            <li>순서(Seq)를 지정하여 리포트에서 Process 정렬 순서를 제어할 수 있습니다.</li>
                        </ul>
                    </section>

                    <section>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">7. 문제 해결</h3>
                        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
                            <p class="font-semibold text-yellow-800 mb-2">데이터가 업로드되지 않을 때:</p>
                            <ul class="list-disc list-inside text-yellow-700 space-y-1 ml-4 text-sm">
                                <li>엑셀 파일에 'Raw' 시트가 있는지 확인</li>
                                <li>필수 헤더가 모두 포함되어 있는지 확인</li>
                                <li>날짜/시간 데이터가 올바른 형식인지 확인</li>
                                <li>브라우저 콘솔(F12)에서 오류 메시지 확인</li>
                            </ul>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <!-- Worker Detail Modal -->
    <div id="workerDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4" onclick="closeWorkerDetailModal(event)">
        <div class="bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden" onclick="event.stopPropagation()">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white px-6 py-4 flex justify-between items-center flex-shrink-0">
                <h3 class="text-2xl font-bold" id="modalWorkerName">
                    <i class="fas fa-user-circle mr-2"></i>
                    Worker Details
                </h3>
                <button onclick="closeWorkerDetailModal()" class="text-white hover:text-gray-200 transition">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- Summary Section -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="text-gray-600 text-sm font-semibold mb-1" id="modalTotalTimeLabel">Total Work Time</div>
                        <div class="text-2xl font-bold text-gray-900" id="modalTotalMinutes">0</div>
                        <div class="text-xs text-gray-500 mt-1">minutes</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="text-gray-600 text-sm font-semibold mb-1">Work Rate</div>
                        <div class="text-2xl font-bold text-gray-900" id="modalWorkRate">0%</div>
                        <div class="text-xs text-gray-500 mt-1">performance</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="text-gray-600 text-sm font-semibold mb-1">Total Records</div>
                        <div class="text-2xl font-bold text-gray-900" id="modalRecordCount">0</div>
                        <div class="text-xs text-gray-500 mt-1">activities</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="text-gray-600 text-sm font-semibold mb-1">Performance Band</div>
                        <div class="text-xl font-bold text-gray-900" id="modalPerformanceBand">-</div>
                        <div class="text-xs text-gray-500 mt-1">rating</div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-lg border border-gray-200 p-4">
                        <h4 class="font-bold text-gray-800 mb-3">
                            <i class="fas fa-calendar-day mr-2"></i>
                            Daily Work Time
                        </h4>
                        <div style="height: 200px;">
                            <canvas id="modalDailyChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg border border-gray-200 p-4">
                        <h4 class="font-bold text-gray-800 mb-3">
                            <i class="fas fa-clock mr-2"></i>
                            Hourly Work Distribution
                        </h4>
                        <div style="height: 200px;">
                            <canvas id="modalProcessChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Detailed Records Table -->
                <div class="bg-white rounded-lg border border-gray-200 p-4">
                    <h4 class="font-bold text-gray-800 mb-3">
                        <i class="fas fa-list mr-2"></i>
                        Detailed Work Records
                    </h4>
                    <div class="overflow-x-auto max-h-[400px] overflow-y-auto">
                        <table class="w-full text-sm">
                            <thead id="modalRecordsTableHeader" class="bg-gray-100 border-b-2 border-gray-300 sticky top-0">
                                <tr>
                                    <th class="text-left p-2 font-semibold text-gray-700">Date</th>
                                    <th class="text-left p-2 font-semibold text-gray-700">Shift</th>
                                    <th class="text-left p-2 font-semibold text-gray-700">Start Time</th>
                                    <th class="text-left p-2 font-semibold text-gray-700">End Time</th>
                                    <th class="text-left p-2 font-semibold text-gray-700">Process</th>
                                    <th class="text-left p-2 font-semibold text-gray-700">Work Station</th>
                                    <th class="text-right p-2 font-semibold text-gray-700" title="Calculated from End - Start">
                                        Original<br>
                                        <span class="text-xs font-normal text-gray-500">(min)</span>
                                    </th>
                                    <th class="text-right p-2 font-semibold text-gray-700" title="After overlap removal">
                                        Adjusted<br>
                                        <span class="text-xs font-normal text-gray-500">(min)</span>
                                    </th>
                                    <th class="text-center p-2 font-semibold text-gray-700">Result</th>
                                </tr>
                            </thead>
                            <tbody id="modalRecordsTable" class="divide-y divide-gray-200">
                                <!-- Records will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Glossary Section -->
                    <div id="modalGlossary" class="mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <div class="text-xs text-gray-500 leading-relaxed">
                            <!-- Dynamic content will be inserted by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-12 pt-8 pb-6 border-t border-gray-200 bg-gradient-to-b from-white to-gray-50">
        <div class="container mx-auto px-4 max-w-7xl">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <!-- Left: WAIV Logo & Brand -->
                <div class="flex items-center gap-3">
                    <img src="/waiv-logo.png" alt="WAIV" class="h-8 opacity-80 hover:opacity-100 transition-opacity">
                    <div class="border-l border-gray-300 pl-3">
                        <p class="text-xs text-gray-600 font-medium">MES Individual Performance Report</p>
                        <p class="text-xs text-gray-500">Powered by CS WIND WAIV Platform</p>
                    </div>
                </div>
                
                <!-- Center: Copyright -->
                <div class="text-center">
                    <p class="text-xs text-gray-600">
                        © 2026 <span class="font-semibold text-gray-700">CS WIND</span>. All rights reserved.
                    </p>
                    <p class="text-xs text-gray-500 mt-1">
                        WAIV | AIX Team
                    </p>
                </div>
                
                <!-- Right: Developer Info -->
                <div class="text-right">
                    <p class="text-xs text-gray-600">
                        <i class="fas fa-code text-blue-500 mr-1"></i>
                        Developed by <span class="font-semibold text-gray-700">JB Park</span>
                    </p>
                    <p class="text-xs text-gray-500 mt-1">
                        <i class="fas fa-envelope text-gray-400 mr-1"></i>
                        <a href="mailto:jbpark@cswind.com" class="hover:text-blue-600 transition-colors">jbpark@cswind.com</a>
                    </p>
                </div>
            </div>
            
            <!-- Bottom: Version & Tech Stack -->
            <div class="mt-4 pt-4 border-t border-gray-100 text-center">
                <p class="text-xs text-gray-400">
                    <span class="inline-flex items-center gap-2">
                        <span class="px-2 py-1 bg-blue-50 text-blue-600 rounded font-mono">v3.1.0</span>
                        <span>|</span>
                        <span><i class="fas fa-server mr-1"></i>Cloudflare Pages + D1</span>
                        <span>|</span>
                        <span><i class="fas fa-bolt mr-1"></i>Hono Framework</span>
                        <span>|</span>
                        <span><i class="fas fa-chart-line mr-1"></i>Chart.js</span>
                    </span>
                </p>
            </div>
        </div>
    </footer>

    <script src="js/app.js?v=1771690200"></script>
</body>
</html>
